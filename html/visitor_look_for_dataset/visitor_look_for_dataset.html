<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>visitor_look_for_dataset</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css" />
    <link rel="stylesheet" href="assets/css/Continue-Button.css" />
    <link rel="stylesheet" href="assets/css/food-table-meny.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"
    />
    <link rel="stylesheet" href="assets/css/styles.css" />
  </head>

    <style>
      body {
        background: url("./assets/img/sea.jpg");
        background-size: cover;
      }
    </style>

  <body>
    <section>
      <div class="text-center" style="padding-top: 30px; padding-bottom: 20px">
        <h1
          class="text-monospace"
          style="
            font-style: normal;
            font-weight: bold;
            color: lightblue;
            font-size: 70px;
            text-align: center;
            filter: grayscale(40%);
            text-shadow: 1px 0px 2px rgba(52, 58, 64, 0.99);
          "
        >
          数据集查看
        </h1>
        <h1
          class="text-monospace"
          style="
            font-style: normal;
            font-weight: bold;
            color: lightblue;
            font-size: 70px;
            text-align: center;
            filter: grayscale(40%);
            text-shadow: 1px 0px 2px rgba(52, 58, 64, 0.99);
          "
        ></h1>
        <button
          class="btn btn-primary btn-sm text-truncate shadow-none float-right tenant-continue-btn next_btn"
          data-bss-hover-animate="pulse"
          type="button"
        >
          下一页&nbsp;&nbsp;<i
            class="fas fa-greater-than continue-icon"
          ></i></button
        ><button
          class="btn btn-primary btn-sm text-truncate shadow-none float-right tenant-continue-btn previous_btn"
          data-bss-hover-animate="pulse"
          type="button"
        >
          上一页&nbsp;&nbsp;<i class="fas fa-less-than continue-icon"></i>
        </button>
        <hr style="width: 100px; border: 3px solid var(--light)" />
      </div>
      <div class="border rounded-0 border">
        <div class="container-fluid text-monospace">
          <div class="row row-size">
            <div class="col">
              <div class="table-responsive">
                <table class="table">
                  <thead
                    style="
                      background: rgb(82, 125, 211);
                      color: var(--light);
                      border-top-color: rgba(128, 128, 128, 0);
                    "
                  >
                    <tr style="border-top-color: rgba(128, 128, 128, 0)">
                      <th
                        style="
                          font-size: 20px;
                          text-align: center;
                          color: var(--light);
                        "
                        class="pat_name"
                      >
                        访客名字
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td
                        class="menu-item"
                        style="
                          background: rgba(255, 255, 255, 0);
                          border-top-width: 0px;
                        "
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num0">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name0">&nbsp; Bold</strong
                        ><a class="depict det0" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num1">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name1">&nbsp; Bold</strong
                        ><a class="depict two det1" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num2">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name2">&nbsp; Bold</strong
                        ><a class="depict three det2" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num3">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name3">&nbsp; Bold</strong
                        ><a class="depict four det3" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num4">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name4">&nbsp; Bold</strong
                        ><a class="depict five det4" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num5">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name5">&nbsp; Bold</strong
                        ><a class="depict six det5" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num6">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name6">&nbsp; Bold</strong
                        ><a class="depict seven det6" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num7">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name7">&nbsp; Bold</strong
                        ><a class="depict eight det7" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num8">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name8">&nbsp; Bold</strong
                        ><a class="depict nine det8" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="menu-item"
                        style="background: rgba(255, 255, 255, 0)"
                      >
                        <img
                          class="dataset-img"
                          src="./assets/img/data.jpg"
                        />
                        <ul class="info">
                          <li class="num9">数据集授权天数</li>
                        </ul>
                        <strong class="dataset-name name9">&nbsp; Bold</strong
                        ><a class="depict ten det9" target="_blank">数据集网址链接（点击跳转）</a>
                      </td>
                    </tr>
                    <tr></tr>
                    <tr></tr>
                    <tr></tr>
                    <tr></tr>
                    <tr></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="container-fluid text-monospace">
          <div class="row"></div>
        </div>
      </div>
    </section>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="assets/js/cryptico.js"></script>
    <script src="assets/js/no_encrypty.js"></script>
  </body>

  <script>
    // 获取当前访客账号信息
    var user_no = parseInt(url_parser(window.location.search));

    // 显示访客名字
    $.ajax({
      type: "post",
      url: "http://127.0.0.1:8000/user/api/",
      async: true,
      data: {
        action: "search_Visitor",
        no: user_no,
        no_op: user_no,
      },
      datatype: "json",
    })
      .then(function (res) {
        if (res["ret"] == 1) {
          $(".pat_name").text(res["retlist"][0]["name"]);
        } else {
          alert("服务器暂无连接");
        }
      })
      .catch(function () {
        alert("服务器暂无连接");
      });

    // 返回获取的数据集名字和数据集授权天数
    function get_dataset_name() {
      var dataset_name_list = [];
      $.ajax({
        type: "post",
        url: "http://127.0.0.1:8000/user/api/",
        async: false,
        data: {
          action: "search_Authorization",
          Au_no: user_no,
          no_op: user_no,
        },
        datatype: "json",
        success: function (res) {
          if (res["ret"] == 1) {
            ret_list = res["retlist"];
            date = ret_list.slice(-1)[0]["Au_date"];
            for (var i = 1; i <= ret_list.length; i++) {
              if (ret_list.slice(-i)[0]["Au_date"] == date)
                dataset_name_list.push({
                  d_name: ret_list.slice(-i)[0]["d_name_id"],
                  Au_num: ret_list.slice(-i)[0]["Au_num"],
                });
              else break;
            }
          } else {
            alert("服务器暂无连接");
          }
        },
        error: function () {
          alert("服务器暂无连接");
        },
      });
      return dataset_name_list;
    }

    // 返回某个数据集的详细信息 包括使用频率 每次服用剂量 价格 数据集网址链接（点击跳转）
    function get_dataset_info(dict) {
      $.ajax({
        type: "post",
        url: "http://127.0.0.1:8000/user/api/",
        async: false,
        data: {
          action: "search_Dataset",
          d_name: dict["d_name"],
          no_op: user_no,
        },
        datatype: "json",
        success: function (res) {
          if (res["ret"] == 1) {
            ret_list = res["retlist"][0];
            dict["m_one_use"] = ret_list["m_one_use"];
            dict["m_freq"] = ret_list["m_freq"];
            dict["m_price"] = ret_list["m_price"];
            dict["d_presc"] = ret_list["d_presc"];
          } else {
            alert("服务器暂无连接");
          }
        },
        error: function () {
          alert("服务器暂无连接");
        },
      });
    }

    dataset_name_list = get_dataset_name();

    for (var j in dataset_name_list) {
      get_dataset_info(dataset_name_list[j]);
    }

    var cur_page = 0; // 全局变量标定当前所指示页面数

    // 更新当前页面所显示内容
    function update_page() {
      for (var i = 0; i < 10; i++) {
        if (cur_page * 10 + i < dataset_name_list.length) {
          $(".num" + i).text(
            "数据集授权天数: " + dataset_name_list[cur_page * 10 + i]["Au_num"]
          );
          $(".name" + i).text(dataset_name_list[cur_page * 10 + i]["d_name"]);
          $(".det" + i).attr(
            "href",
            dataset_name_list[cur_page * 10 + i]["d_presc"]
          ); // 更新链接
        } else {
          $(".name" + i).text("无更多数据集信息");
          $(".num" + i).text("无");

          $(".det" + i).text("无");
        }
      }
    }

    // 初始值直接调用update_page
    update_page();

    // 按下.btn.btn-primary.btn-sm.float-right.tenant-continue-btn.previous_btn 往前翻页
    $(
      ".btn.btn-primary.btn-sm.float-right.tenant-continue-btn.previous_btn"
    ).click(function () {
      if (cur_page > 0) {
        cur_page -= 1;
        update_page();
      }
    });

    // 按下.btn.btn-primary.btn-sm.float-right.tenant-continue-btn.next_btn 往后翻页
    $(".btn.btn-primary.btn-sm.float-right.tenant-continue-btn.next_btn").click(
      function () {
        if ((cur_page + 1) * 10 < dataset_name_list.length) {
          cur_page += 1;
          update_page();
        }
      }
    );
  </script>
</html>
