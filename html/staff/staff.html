<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Home - Brand</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,700,700i,600,600i"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400|Roboto:300,400,700"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400|Roboto:300,400,700"
    />
    <link rel="stylesheet" href="assets/fonts/simple-line-icons.min.css" />
    <link rel="stylesheet" href="assets/css/Floating-Button.css" />
    <link rel="stylesheet" href="assets/css/Floating-Up--Down-Animation.css" />
    <link rel="stylesheet" href="assets/css/Highlight-Clean.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.css"
    />
    <link rel="stylesheet" href="assets/css/PHP-Contact-Form-dark-1.css" />
    <link rel="stylesheet" href="assets/css/PHP-Contact-Form-dark.css" />
    <link rel="stylesheet" href="assets/css/smoothproducts.css" />
    <link
      rel="stylesheet"
      href="assets/css/sticky-dark-top-nav-with-dropdown.css"
    />
    <link rel="stylesheet" href="assets/css/untitled-1.css" />
    <link rel="stylesheet" href="assets/css/untitled.css" />
    <link
      rel="stylesheet"
      href="assets/css/Wave-Animation-Circle-and-Square.css"
    />
  </head>

  <body>
    <nav
      class="navbar navbar-light navbar-expand-lg fixed-top bg-white clean-navbar"
    >
      <div class="container">
        <a class="navbar-brand logo" href="#">Hello</a
        ><button
          data-toggle="collapse"
          data-target="#navcol-1"
          class="navbar-toggler"
        >
          <span class="sr-only">Toggle navigation</span
          ><span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navcol-1">
          <div class="collapse navbar-collapse" id="navcol-1">
            <ul class="navbar-nav nav-right">
              <li class="nav-item"></li>
              <li class="nav-item dropdown">
                <a
                  class="dropdown-toggle nav-link"
                  aria-expanded="false"
                  data-toggle="dropdown"
                  href="#"
                  >个人设置</a
                >
                <div class="dropdown-menu">
                  <a class="dropdown-item dropdown-item1">修改个人信息</a
                  ><a class="dropdown-item dropdown-item2"
                    >更新权限审核受理队列</a
                  >
                </div>
              </li>
              <li class="nav-item"></li>
              <li class="nav-item"></li>
              <li class="nav-item"></li>
            </ul>
            <p class="ml-auto navbar-text actions"></p>
          </div>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"></li>
            <li class="nav-item">
              <a class="nav-link active exit" id="btn_exit">退出登录</a>
            </li>
            <li class="nav-item"></li>
            <li class="nav-item"></li>
            <li class="nav-item"></li>
          </ul>
        </div>
      </div>
    </nav>
    <main class="page landing-page">
      <section
        class="clean-block clean-hero"
        style="
          background-image: url('./assets/img/sea.jpg');
          color: rgba(9, 162, 255, 0.15);
          height: 1000px;
        "
      >
        <div id="contact-hidden_personal_set">
          <div class="container php_info">
            <div class="intro">
              <h2 class="php_h2">个人信息修改设置</h2>
              <p class="php_ppp">please update your self information here</p>
            </div>
            <form id="contact-form" action="" method="post">
              <div class="messages"></div>
              <div class="form-row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="form_email">在线受理开始时间/begin* </label
                    ><input
                      class="form-control form_time_begin"
                      type="number"
                      id="form_email"
                      data-error="请输入正确的开始时间(整点)"
                      name="email"
                      required=""
                      placeholder="请输入更新后的开始时间(整点)"
                      autocomplete="off"
                      min="7"
                      max="23"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="form_email">在线受理结束时间/end* </label
                    ><input
                      class="form-control form_time_end"
                      type="number"
                      id="form_email"
                      data-error="请输入正确的结束时间(整点)"
                      name="email"
                      required=""
                      placeholder="请输入更新后的结束时间(整点)"
                      autocomplete="off"
                      min="7"
                      max="23"
                    />
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="col-md-12">
                  <button
                    class="btn btn-success btn-send btn_ok"
                    value="Senden"
                  >
                    OK</button
                  ><button
                    class="btn btn-success btn-send"
                    id="btn_close"
                    value="Senden"
                  >
                    CLOSE
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="text">
          <h2 class="how_h2"><span class="obtain_info"></span>您好！&nbsp;</h2>
          <p class="intro cua_index">
            您的当前综合服务评分指数为&nbsp; &nbsp; &nbsp; xxx分
          </p>
          <p class="intro">
            欢迎登录海洋海面高度数据开放平台&nbsp; &nbsp; &nbsp;
            数据权限审核界面
          </p>
          <button class="btn btn-outline-light btn-lg" type="button">
            <a href="#jump">Search More</a>
          </button>
        </div>
      </section>
      <section class="clean-block clean-info dark">
        <div class="container">
          <div class="block-heading" id="jump">
            <div class="w-100 p-5">
              <div class="wave-circle mx-auto my-5">
                <div class="wave-effect"><span></span></div>
              </div>
            </div>
            <h2 class="text-info" data-bss-hover-animate="shake">
              为用户进行数据权限审核
            </h2>
            <p>
              Review requests for data access rights submitted by website
              users&nbsp;
            </p>
            <span class="span_now"
              >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
              &nbsp; &nbsp; &nbsp;NOW</span
            >
          </div>
          <div class="row align-items-center">
            <div class="col-md-6">
              <img class="img-thumbnail" src="./assets/img/lock.png" />
            </div>
            <div class="col-md-6">
              <h3>权限审核介绍</h3>
              <div class="getting-started-info">
                <p>
                  系统提供该接口用于数据平台工作人员为用户的数据访问申请进行审核<br />受理完毕后访客可对海洋海面高度数据进行查看<br />
                </p>
              </div>

              <button
                class="btn btn-outline-primary btn-lg authorization"
                type="button"
              >
                Start Now
              </button>
            </div>
          </div>
        </div>
      </section>
      <section class="clean-block slider dark">
        <section class="highlight-clean">
          <div class="container">
            <div class="intro">
              <h2 class="text-center" data-bss-hover-animate="shake">
                反馈意见查看
              </h2>
              <p class="text-center">
                <br />You could see the comment feedback of yourself by visitors
                at here.<br /><br />
              </p>
            </div>
            <img
              class="img-fluid UpnDown img_updown"
              src="./assets/img/feedback.png"
              alt="visuo xs816 drone"
            />
            <div class="buttons">
              <a class="btn btn-primary search_medi feedback" role="button"
                >CHECK IT NOW</a
              >
            </div>
          </div>
        </section>
      </section>
    </main>
    <footer class="page-footer dark">
      <div class="container">
        <div class="row">
          <div class="col-sm-3">
            <h5>Get started</h5>
            <ul>
              <li><a href="#">Home</a></li>
              <li><a href="#">Sign up</a></li>
              <li><a href="#">Downloads</a></li>
            </ul>
          </div>
          <div class="col-sm-3">
            <h5>About us</h5>
            <ul>
              <li><a href="#">Company Information</a></li>
              <li><a href="#">Contact us</a></li>
              <li><a href="#">Reviews</a></li>
            </ul>
          </div>
          <div class="col-sm-3">
            <h5>Support</h5>
            <ul>
              <li><a href="#">FAQ</a></li>
              <li><a href="#">Help desk</a></li>
              <li><a href="#">Forums</a></li>
            </ul>
          </div>
          <div class="col-sm-3">
            <h5>Legal</h5>
            <ul>
              <li><a href="#">Terms of Service</a></li>
              <li><a href="#">Terms of Use</a></li>
              <li><a href="#">Privacy Policy</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer-copyright">
        <p>© 2024 Copyright 2151131 Shatong Zhu</p>
      </div>
    </footer>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.10.0/baguetteBox.min.js"></script>
    <script src="assets/js/smoothproducts.min.js"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/PHP-Contact-Form-dark-1.js"></script>
    <script src="assets/js/PHP-Contact-Form-dark.js"></script>
    <script src="assets/js/cryptico.js"></script>
    <script src="assets/js/no_encrypty.js"></script>
  </body>

  <script>
    function Init_display_none() {
      $("#contact-hidden_personal_set").css("display", "none");
      $("#form_email").val("");
    }

    /* 获取当前工作人员的账户信息 */
    var doc_no = parseInt(url_parser(window.location.search));

    /* 初始时将个人信息display设置为none */
    Init_display_none();

    /*初始时通过后端获取工作人员姓名信息 和综合评分*/
    function obtain_name() {
      $.ajax({
        type: "post",
        url: "http://127.0.0.1:8000/user/api/",
        async: true,
        data: {
          action: "search_Staff",
          no: doc_no,
          no_op: doc_no,
        },
        datatype: "json",
      }).then(function (res) {
        if (res["ret"] == 1) {
          res_list = res["retlist"];
          user_name = res_list[0]["name"];
          $(".obtain_info").text(user_name + " ");
          $(".obtain_info").css({
            color: "rgba(0,0,255,1)",
          });
          $(".cua_index").text(
            "您的当前综合评分指数为:   " + res_list[0]["s_index"] + "分"
          );
        }
      });
    }
    obtain_name();

    /* 在点击dropdown-item1将个人设置显示出来 */
    $(".dropdown-item1").click(function () {
      $("#contact-hidden_personal_set").fadeIn(1000);
    });

    /* 在点击btn_close后 关闭个人信息设置 */
    $("#btn_close").click(function () {
      $("#contact-hidden_personal_set").fadeOut(1000);
    });

    /* 在点击.btn_ok后 向服务器发送数据 修改访客信息 */
    $(".btn_ok").click(function () {
      var time_begin = $(".form_time_begin").val();
      var time_end = $(".form_time_end").val();

      if (time_begin == "" || time_end == "") return;
      else if (
        parseInt(time_begin) <= 0 ||
        parseInt(time_begin) >= 24 ||
        parseInt(time_end) <= 0 ||
        parseInt(time_end) >= 24 ||
        parseInt(time_begin) >= parseInt(time_end)
      )
        return;
      $.ajax({
        type: "post",
        url: "http://127.0.0.1:8000/user/api/",
        async: true,
        data: {
          action: "update_Staff",
          no: doc_no,
          s_time_begin: time_begin,
          s_time_end: time_end,
          no_op: doc_no,
        },
        datatype: "json",
      })
        .then(function (res) {
          if (res["ret"] == 1) {
            alert("修改成功");
            Init_display_none();
          } else alert("修改失败，请重试");
        })
        .catch(function (res) {
          alert("服务器暂无连接");
        });
    });

    /* 点击退出登录 退回到login界面 */
    $("#btn_exit").click(function () {
      window.location.replace("../login/login.html");
    });

    //获取今天的日期 返回字符串
    function get_cua_date() {
      var myDate = new Date();
      var year = myDate.getFullYear();
      var month = myDate.getMonth() + 1;
      var day = myDate.getDate();
      return year + "-" + month + "-" + day;
    }

    $("#btn_exit").hover(function () {
      $(this).css("cursor", "pointer");
    });

    $(".dropdown-item").hover(function () {
      $(this).css("cursor", "pointer");
    });

    // 获取工作人员当前最大申请号码
    function get_certain_staff_max_register() {
      var max_register_cnt = 0;
      $.ajax({
        type: "post",
        url: "http://127.0.0.1:8000/user/api/",
        async: false,
        data: {
          action: "search_Apply",
          a_date: get_cua_date(),
          a_no_staff: doc_no,
          no_op: doc_no,
        },
        datatype: "json",
        success: function (res) {
          if (res["retlist"].length == 0) max_register_cnt = 0;
          else
            max_register_cnt =
              res["retlist"][res["retlist"].length - 1]["a_index"];
        },
        error: function () {
          alert("服务器暂无连接");
        },
      });
      return max_register_cnt;
    }

    // 获取工作人员当前进度号码
    function get_certain_staff_cur_register() {
      var cur_register;
      $.ajax({
        type: "post",
        url: "http://127.0.0.1:8000/user/api/",
        async: false,
        data: {
          action: "search_Current_Apply",
          a_date: get_cua_date(),
          a_no_staff: doc_no,
          no_op: doc_no,
        },
        datatype: "json",
        success: function (res) {
          if (res["retlist"].length == 0) cur_register = 0;
          else
            cur_register = res["retlist"][res["retlist"].length - 1]["a_index"];
        },
        error: function () {
          alert("服务器暂无连接");
        },
      });
      return cur_register;
    }

    // 点击更新到号信息
    $(".dropdown-item2").click(function () {

      var max_reg_cnt = get_certain_staff_max_register();
      var cur_reg_cnt = get_certain_staff_cur_register();
      alert("当前最大申请号码为:" + max_reg_cnt + " 当前进度为:" + cur_reg_cnt);
      if (max_reg_cnt == 0) {
        alert("您当前暂无申请信息，请稍后重试");
        return;
      } else if (max_reg_cnt == cur_reg_cnt) {
        alert("您当前申请已全部审理完毕，请稍后重试");
        return;
      } else if (cur_reg_cnt < max_reg_cnt) {

        cur_reg_cnt += 1;
        if (cur_reg_cnt == 1) {
          $.ajax({
            type: "post",
            url: "http://127.0.0.1:8000/user/api/",
            async: true,
            data: {
              action: "add_Current_Apply",
              a_index: cur_reg_cnt,
              a_date: get_cua_date(),
              a_no_staff: doc_no,
              no_op: doc_no,
            },
            datatype: "json",
            success: function (res) {
              if (res["ret"] == 1) alert("更新当前进度为:" + cur_reg_cnt);
              else alert("服务器暂无连接");
            },
            error: function () {
              alert("服务器暂无连接");
            },
          });
        } else {
          $.ajax({
            type: "post",
            url: "http://127.0.0.1:8000/user/api/",
            async: true,
            data: {
              action: "update_Current_Apply",
              a_index: cur_reg_cnt,
              a_date: get_cua_date(),
              a_no_staff: doc_no,
              no_op: doc_no,
            },
            datatype: "json",
            success: function (res) {
              if (res["ret"] == 1) alert("更新当前进度为:" + cur_reg_cnt);
              else alert("服务器暂无连接");
            },
            error: function () {
              alert("服务器暂无连接");
            },
          });
        }
      }
    });

    // 点击Authorization Now 若当前到号为0 则无法开处方
    $(".authorization").click(function () {
      var cur_reg = get_certain_staff_cur_register();
      if (cur_reg == 0) {
        alert(
          "您当前进度为0，还无法开具处方信息 请您先在个人设置中更新进度信息"
        );
        return;
      } else {
        window.open(
          url_generate("../authorization/authorization.html", [doc_no])
        );
      }
    });

    // 点击查看意见信息 直接页面跳转
    $(".feedback").click(function () {
      window.open(
        url_generate("../staff_look_for_comment/staff_look_for_comment.html", [
          doc_no,
        ])
      );
    });
  </script>
</html>
